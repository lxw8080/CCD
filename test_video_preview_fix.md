# PC端视频预览修复测试指南

## 测试目的

验证PC端客户资料页面视频预览关闭后，声音是否正确停止播放。

## 测试前准备

1. 确保已经上传了至少一个视频文件到客户资料中
   - 支持的视频格式：mp4, avi, mov, wmv, flv, mkv

2. 确保前端服务正在运行：
   ```bash
   cd frontend
   npm run dev
   ```

## 测试步骤

### 测试用例 1：正常关闭视频预览

1. 使用浏览器访问客户详情页面（PC端）
2. 在"已上传资料"列表中找到一个视频文件
3. 点击"预览"按钮
4. 等待视频加载并开始播放
5. 让视频播放几秒钟
6. 点击对话框右上角的"X"关闭按钮

**预期结果：**
- ✅ 对话框关闭
- ✅ 视频声音立即停止
- ✅ 没有任何声音继续播放

### 测试用例 2：点击对话框外部关闭

1. 再次点击视频的"预览"按钮
2. 等待视频播放
3. 点击对话框外部的灰色遮罩区域

**预期结果：**
- ✅ 对话框关闭
- ✅ 视频声音立即停止

### 测试用例 3：重新打开预览

1. 关闭视频预览后
2. 再次点击同一个视频的"预览"按钮

**预期结果：**
- ✅ 视频从头开始播放（播放位置为 0:00）
- ✅ 不会从上次停止的位置继续播放

### 测试用例 4：切换预览不同文件

1. 打开一个视频预览并播放
2. 关闭预览
3. 打开另一个视频或图片预览

**预期结果：**
- ✅ 之前的视频声音已完全停止
- ✅ 新的预览正常显示

## 常见问题排查

### 问题：视频无法播放

**可能原因：**
- 浏览器不支持该视频格式
- 视频文件损坏

**解决方法：**
- 尝试上传其他格式的视频文件
- 使用 Chrome 或 Edge 浏览器测试

### 问题：修改后前端没有更新

**解决方法：**
```bash
# 停止前端服务（Ctrl+C）
# 清除缓存并重新启动
cd frontend
npm run dev
```

如果还是没有更新，尝试清除浏览器缓存：
- Chrome/Edge: Ctrl + Shift + Delete，选择"缓存的图片和文件"

## 移动端测试

移动端已经有正确的视频停止逻辑，但你也可以测试确认：

1. 使用手机或浏览器的移动设备模拟器访问
2. 打开客户详情页面
3. 预览视频
4. 点击"关闭"按钮

**预期结果：**
- ✅ 视频声音立即停止
- ✅ 视频元素被正确清理

## 技术细节

修复通过以下方式实现：
1. 使用 Vue 的 `ref` 获取视频元素的引用
2. 在关闭对话框时调用 `pause()` 方法暂停播放
3. 重置 `currentTime` 到 0，确保下次从头播放

修改的文件：
- `frontend/src/components/FilePreview/PreviewDialog.vue`

---

测试完成后，请在下方记录测试结果：

- [ ] 测试用例 1 通过
- [ ] 测试用例 2 通过
- [ ] 测试用例 3 通过
- [ ] 测试用例 4 通过
- [ ] 移动端测试通过

测试人员：_______________
测试日期：_______________

